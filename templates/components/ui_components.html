{# UI Components - Standardized interface elements for a consistent design system #}

{# Buttons #}
{% macro button(text, type='primary', size='', icon='', outline=false, classes='', attributes='') %}
<button class="btn btn{% if outline %}-outline{% endif %}-{{ type }} {% if size %}btn-{{ size }}{% endif %} {{ classes }}" {{ attributes | safe }}>
    {% if icon %}
    <i class="bi bi-{{ icon }} {% if text %}me-1{% endif %}"></i>
    {% endif %}
    {% if text %}{{ text }}{% endif %}
</button>
{% endmacro %}

{% macro icon_button(icon, tooltip='', type='primary', size='', outline=false, circle=false, classes='', attributes='') %}
<button class="btn btn{% if outline %}-outline{% endif %}-{{ type }} {% if size %}btn-{{ size }}{% endif %} {% if circle %}btn-circle{% endif %} {{ classes }}"
        {% if tooltip %}data-bs-toggle="tooltip" data-bs-placement="top" title="{{ tooltip }}"{% endif %}
        {{ attributes | safe }}>
    <i class="bi bi-{{ icon }}"></i>
</button>
{% endmacro %}

{% macro action_button(text, type='primary', icon='', url='', js_action='', classes='', attributes='') %}
{% if url %}
<a href="{{ url }}" class="btn btn-{{ type }} {{ classes }}" {{ attributes | safe }}>
{% else %}
<button onclick="{{ js_action }}" class="btn btn-{{ type }} {{ classes }}" {{ attributes | safe }}>
{% endif %}
    {% if icon %}
    <i class="bi bi-{{ icon }} {% if text %}me-1{% endif %}"></i>
    {% endif %}
    {% if text %}{{ text }}{% endif %}
{% if url %}
</a>
{% else %}
</button>
{% endif %}
{% endmacro %}

{# Cards #}
{% macro card(title='', subtitle='', icon='', body_classes='', card_classes='', header_classes='', footer_classes='', footer=none, header_actions=none) %}
<div class="card shadow-sm {{ card_classes }}">
    {% if title or icon or header_actions %}
    <div class="card-header d-flex justify-content-between align-items-center {{ header_classes }}">
        <div class="d-flex align-items-center">
            {% if icon %}
            <i class="bi bi-{{ icon }} me-2" style="font-size: 1.25rem;"></i>
            {% endif %}
            <div>
                {% if title %}
                <h5 class="card-title mb-0">{{ title }}</h5>
                {% endif %}
                {% if subtitle %}
                <h6 class="card-subtitle text-muted">{{ subtitle }}</h6>
                {% endif %}
            </div>
        </div>
        {% if header_actions %}
        <div class="card-actions">
            {{ header_actions | safe }}
        </div>
        {% endif %}
    </div>
    {% endif %}
    <div class="card-body {{ body_classes }}">
        {{ caller() }}
    </div>
    {% if footer %}
    <div class="card-footer {{ footer_classes }}">
        {{ footer | safe }}
    </div>
    {% endif %}
</div>
{% endmacro %}

{% macro stat_card(title, value, subtitle='', icon='', change='', change_type='', card_classes='', text_classes='') %}
<div class="card shadow-sm {{ card_classes }}">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-start">
            <div>
                <h6 class="text-muted mb-1">{{ title }}</h6>
                <h3 class="mb-0 {{ text_classes }}">{{ value }}</h3>
                {% if subtitle %}
                <small class="text-muted">{{ subtitle }}</small>
                {% endif %}
            </div>
            {% if icon %}
            <div class="stat-icon bg-light rounded p-2">
                <i class="bi bi-{{ icon }}" style="font-size: 1.5rem;"></i>
            </div>
            {% endif %}
        </div>
        {% if change %}
        <div class="mt-3 pt-1 border-top">
            <span class="{% if change_type == 'positive' %}text-success{% elif change_type == 'negative' %}text-danger{% else %}text-muted{% endif %}">
                <i class="bi bi-{% if change_type == 'positive' %}arrow-up-right{% elif change_type == 'negative' %}arrow-down-right{% else %}arrow-right{% endif %} me-1"></i>
                {{ change }}
            </span>
        </div>
        {% endif %}
    </div>
</div>
{% endmacro %}

{# Tables #}
{% macro data_table(id, headers, responsive=true, striped=true, hoverable=true, bordered=false, small=false, classes='') %}
<div {% if responsive %}class="table-responsive"{% endif %}>
    <table id="{{ id }}" class="table {% if striped %}table-striped{% endif %} {% if hoverable %}table-hover{% endif %} {% if bordered %}table-bordered{% endif %} {% if small %}table-sm{% endif %} {{ classes }}">
        <thead>
            <tr>
                {% for header in headers %}
                <th>{{ header }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {{ caller() }}
        </tbody>
    </table>
</div>
{% endmacro %}

{# Badges #}
{% macro status_badge(status, size='', pill=true) %}
{% set color = {
    'active': 'success',
    'inactive': 'secondary',
    'pending': 'warning',
    'running': 'primary',
    'completed': 'success',
    'failed': 'danger',
    'scheduled': 'info',
    'critical': 'danger',
    'error': 'danger',
    'warning': 'warning',
    'info': 'info',
    'resolved': 'success',
    'acknowledged': 'primary'
} %}
<span class="badge {% if pill %}rounded-pill{% endif %} bg-{{ color[status.lower()] if status.lower() in color else 'secondary' }} {% if size %}badge-{{ size }}{% endif %}">
    {{ status }}
</span>
{% endmacro %}

{% macro metric_badge(value, label='', type='primary', icon='', tooltip='') %}
<div class="metric-badge bg-light-{{ type }} text-{{ type }} p-2 rounded {% if tooltip %}cursor-help{% endif %}"
     {% if tooltip %}data-bs-toggle="tooltip" data-bs-placement="top" title="{{ tooltip }}"{% endif %}>
    {% if icon %}
    <i class="bi bi-{{ icon }} me-1"></i>
    {% endif %}
    <span class="fw-bold">{{ value }}</span>
    {% if label %}
    <span class="ms-1 small">{{ label }}</span>
    {% endif %}
</div>
{% endmacro %}

{# Charts #}
{% macro chart_container(id, title='', subtitle='', height='300px', responsive=true, card=true, header_actions='') %}
{% if card %}
{% call card(title=title, subtitle=subtitle, header_actions=header_actions, card_classes='chart-card') %}
    <div id="{{ id }}_container" style="height: {{ height }}; {% if responsive %}width: 100%;{% endif %}">
        <canvas id="{{ id }}"></canvas>
    </div>
{% endcall %}
{% else %}
<div id="{{ id }}_container" class="chart-container" style="height: {{ height }}; {% if responsive %}width: 100%;{% endif %}">
    {% if title %}
    <div class="chart-header">
        <h5>{{ title }}</h5>
        {% if subtitle %}<h6 class="text-muted">{{ subtitle }}</h6>{% endif %}
    </div>
    {% endif %}
    <canvas id="{{ id }}"></canvas>
</div>
{% endif %}
{% endmacro %}

{# Alerts #}
{% macro toast(title, message, icon='info-circle', type='primary', autohide=true, delay=5000) %}
<div class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="{{ 'true' if autohide else 'false' }}" data-bs-delay="{{ delay }}">
    <div class="toast-header bg-{{ type }} text-white">
        <i class="bi bi-{{ icon }} me-2"></i>
        <strong class="me-auto">{{ title }}</strong>
        <small>Just now</small>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body">
        {{ message }}
    </div>
</div>
{% endmacro %}

{# Forms #}
{% macro form_group(label, id, input_type='text', value='', placeholder='', required=false, disabled=false, readonly=false, help_text='', input_classes='', label_classes='', error='', error_classes='') %}
<div class="mb-3">
    <label for="{{ id }}" class="form-label {{ label_classes }}">
        {{ label }}{% if required %} <span class="text-danger">*</span>{% endif %}
    </label>
    <input type="{{ input_type }}" class="form-control {{ input_classes }} {% if error %}is-invalid{% endif %}" 
           id="{{ id }}" name="{{ id }}" value="{{ value }}" 
           placeholder="{{ placeholder }}" 
           {% if required %}required{% endif %} 
           {% if disabled %}disabled{% endif %} 
           {% if readonly %}readonly{% endif %}>
    {% if help_text %}
    <div class="form-text">{{ help_text }}</div>
    {% endif %}
    {% if error %}
    <div class="invalid-feedback {{ error_classes }}">{{ error }}</div>
    {% endif %}
</div>
{% endmacro %}

{% macro select_group(label, id, options, selected_value='', placeholder='Select...', required=false, disabled=false, help_text='', multiple=false, classes='', error='') %}
<div class="mb-3">
    <label for="{{ id }}" class="form-label">
        {{ label }}{% if required %} <span class="text-danger">*</span>{% endif %}
    </label>
    <select class="form-select {{ classes }} {% if error %}is-invalid{% endif %}" 
            id="{{ id }}" name="{{ id }}" 
            {% if required %}required{% endif %} 
            {% if disabled %}disabled{% endif %}
            {% if multiple %}multiple{% endif %}>
        {% if placeholder and not multiple %}
        <option value="" {% if not selected_value %}selected{% endif %}>{{ placeholder }}</option>
        {% endif %}
        {% for option in options %}
            {% if option is mapping %}
                <option value="{{ option.value }}" {% if option.value == selected_value %}selected{% endif %}>{{ option.text }}</option>
            {% else %}
                <option value="{{ option }}" {% if option == selected_value %}selected{% endif %}>{{ option }}</option>
            {% endif %}
        {% endfor %}
    </select>
    {% if help_text %}
    <div class="form-text">{{ help_text }}</div>
    {% endif %}
    {% if error %}
    <div class="invalid-feedback">{{ error }}</div>
    {% endif %}
</div>
{% endmacro %}

{# Navigation #}
{% macro tab_nav(id, tabs, active_tab='', classes='') %}
<ul class="nav nav-tabs {{ classes }}" id="{{ id }}" role="tablist">
    {% for tab in tabs %}
    <li class="nav-item" role="presentation">
        <button class="nav-link {% if tab.id == active_tab %}active{% endif %}" 
                id="{{ tab.id }}-tab" 
                data-bs-toggle="tab" 
                data-bs-target="#{{ tab.id }}-content" 
                type="button" 
                role="tab" 
                aria-controls="{{ tab.id }}-content" 
                aria-selected="{% if tab.id == active_tab %}true{% else %}false{% endif %}">
            {% if tab.icon %}
            <i class="bi bi-{{ tab.icon }} me-1"></i>
            {% endif %}
            {{ tab.title }}
            {% if tab.badge %}
            <span class="badge bg-{{ tab.badge_type|default('secondary') }} ms-1 rounded-pill">{{ tab.badge }}</span>
            {% endif %}
        </button>
    </li>
    {% endfor %}
</ul>
<div class="tab-content" id="{{ id }}Content">
    {% for tab in tabs %}
    <div class="tab-pane fade {% if tab.id == active_tab %}show active{% endif %}" id="{{ tab.id }}-content" role="tabpanel" aria-labelledby="{{ tab.id }}-tab">
        {{ tab.content | safe if tab.content }}
    </div>
    {% endfor %}
</div>
{% endmacro %}

{% macro pagination(current_page, total_pages, url_pattern, boundary_count=1, size='') %}
<nav aria-label="Page navigation">
    <ul class="pagination {% if size %}pagination-{{ size }}{% endif %} justify-content-center">
        <li class="page-item {% if current_page == 1 %}disabled{% endif %}">
            <a class="page-link" href="{{ url_pattern.format(page=current_page-1) if current_page > 1 else '#' }}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
        </li>
        
        {% for i in range(1, total_pages + 1) %}
            {% if i <= boundary_count or i > total_pages - boundary_count or (i >= current_page - 2 and i <= current_page + 2) %}
                <li class="page-item {% if i == current_page %}active{% endif %}">
                    <a class="page-link" href="{{ url_pattern.format(page=i) }}">{{ i }}</a>
                </li>
            {% elif i == boundary_count + 1 or i == total_pages - boundary_count %}
                <li class="page-item disabled">
                    <span class="page-link">...</span>
                </li>
            {% endif %}
        {% endfor %}
        
        <li class="page-item {% if current_page == total_pages %}disabled{% endif %}">
            <a class="page-link" href="{{ url_pattern.format(page=current_page+1) if current_page < total_pages else '#' }}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
            </a>
        </li>
    </ul>
</nav>
{% endmacro %}