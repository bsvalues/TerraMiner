{% macro button(text="Button", type="primary", size="md", icon=None, url=None, onclick=None, classes="", attrs={}) %}
{% set button_style = 'btn-' + (type if type != 'primary' or ui_template != 'unified' else 'teal') %}
{% set button_size = 'btn-' + size %}
<{% if url %}a href="{{ url }}" {% else %}button type="button" {% if onclick %}onclick="{{ onclick }}"{% endif %}{% endif %} class="btn {{ button_style }} {{ button_size }} {{ classes }}" 
    {% for attr, value in attrs.items() %}{{ attr }}="{{ value }}" {% endfor %}>
    {% if icon %}<i class="fas fa-{{ icon }} me-2"></i>{% endif %}{{ text }}
</{% if url %}a{% else %}button{% endif %}>
{% endmacro %}

{% macro badge(text="Badge", type="primary", pill=false, icon=None) %}
{% set badge_style = 'bg-' + (type if type != 'primary' or ui_template != 'unified' else 'teal') %}
<span class="badge {{ badge_style }} {% if pill %}rounded-pill{% endif %}">
    {% if icon %}<i class="fas fa-{{ icon }} me-1"></i>{% endif %}{{ text }}
</span>
{% endmacro %}

{% macro card(title=None, header_icon=None, footer=None, shadow=true) %}
<div class="card {% if ui_template == 'unified' %}bg-dark-blue border-0 {% if shadow %}shadow{% endif %}{% endif %} mb-4">
    {% if title %}
    <div class="card-header {% if ui_template == 'unified' %}bg-blue{% endif %}">
        <h5 class="card-title mb-0 {% if ui_template == 'unified' %}text-white{% endif %}">
            {% if header_icon %}<i class="fas fa-{{ header_icon }} me-2"></i>{% endif %}{{ title }}
        </h5>
    </div>
    {% endif %}
    <div class="card-body">
        {{ caller() }}
    </div>
    {% if footer %}
    <div class="card-footer {% if ui_template == 'unified' %}bg-blue border-top border-dark{% endif %}">
        {{ footer|safe }}
    </div>
    {% endif %}
</div>
{% endmacro %}

{% macro alert(message, type="primary", dismissible=false, icon=None) %}
{% set alert_style = 'alert-' + (type if type != 'primary' or ui_template != 'unified' else 'teal') %}
<div class="alert {{ alert_style }} {% if ui_template == 'unified' %}bg-opacity-25{% endif %} {% if dismissible %}alert-dismissible fade show{% endif %}" role="alert">
    {% if icon %}<i class="fas fa-{{ icon }} me-2"></i>{% endif %}{{ message }}
    {% if dismissible %}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    {% endif %}
</div>
{% endmacro %}

{% macro data_table(headers, caption=None, striped=true, hover=true, bordered=false, responsive=true) %}
<div {% if responsive %}class="table-responsive"{% endif %}>
    <table class="table {% if ui_template == 'unified' %}table-dark{% endif %} {% if striped %}table-striped{% endif %} {% if hover %}table-hover{% endif %} {% if bordered %}table-bordered{% endif %}">
        {% if caption %}
        <caption {% if ui_template == 'unified' %}class="text-white"{% endif %}>{{ caption }}</caption>
        {% endif %}
        <thead>
            <tr>
                {% for header in headers %}
                <th scope="col" {% if ui_template == 'unified' %}class="text-teal"{% endif %}>{{ header }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {{ caller() }}
        </tbody>
    </table>
</div>
{% endmacro %}

{% macro pagination(current_page, total_pages, base_url, align="center") %}
{% if total_pages > 1 %}
<nav aria-label="Page navigation">
    <ul class="pagination {% if align == 'center' %}justify-content-center{% elif align == 'end' %}justify-content-end{% endif %}">
        <li class="page-item {% if current_page == 1 %}disabled{% endif %}">
            <a class="page-link {% if ui_template == 'unified' %}bg-blue text-white border-dark{% endif %}" 
               href="{{ base_url }}?page={{ current_page - 1 }}" 
               {% if current_page == 1 %}tabindex="-1" aria-disabled="true"{% endif %}>
                <i class="fas fa-chevron-left"></i>
            </a>
        </li>
        
        {% set display_range = 2 %}
        {% for i in range(1, total_pages + 1) %}
            {% if i == 1 or i == total_pages or (i >= current_page - display_range and i <= current_page + display_range) %}
                <li class="page-item {% if current_page == i %}active{% endif %}">
                    <a class="page-link {% if ui_template == 'unified' %}bg-blue text-white border-dark {% if current_page == i %}bg-teal{% endif %}{% endif %}" 
                       href="{{ base_url }}?page={{ i }}">
                        {{ i }}
                    </a>
                </li>
            {% elif i == current_page - display_range - 1 or i == current_page + display_range + 1 %}
                <li class="page-item disabled">
                    <span class="page-link {% if ui_template == 'unified' %}bg-blue text-white border-dark{% endif %}">...</span>
                </li>
            {% endif %}
        {% endfor %}
        
        <li class="page-item {% if current_page == total_pages %}disabled{% endif %}">
            <a class="page-link {% if ui_template == 'unified' %}bg-blue text-white border-dark{% endif %}" 
               href="{{ base_url }}?page={{ current_page + 1 }}"
               {% if current_page == total_pages %}tabindex="-1" aria-disabled="true"{% endif %}>
                <i class="fas fa-chevron-right"></i>
            </a>
        </li>
    </ul>
</nav>
{% endif %}
{% endmacro %}

{% macro tab_nav(tabs, active_tab, base_url=None, id_prefix="tab") %}
<ul class="nav nav-tabs mb-4 {% if ui_template == 'unified' %}nav-tabs-dark{% endif %}" role="tablist">
    {% for tab in tabs %}
    <li class="nav-item" role="presentation">
        {% if base_url %}
        <a class="nav-link {% if active_tab == tab.id %}active{% endif %} {% if ui_template == 'unified' %}text-white{% endif %}" 
           href="{{ base_url }}/{{ tab.id }}">
            {% if tab.icon %}<i class="fas fa-{{ tab.icon }} me-2"></i>{% endif %}{{ tab.label }}
        </a>
        {% else %}
        <button class="nav-link {% if active_tab == tab.id %}active{% endif %} {% if ui_template == 'unified' %}text-white{% endif %}" 
                id="{{ id_prefix }}-{{ tab.id }}-tab" 
                data-bs-toggle="tab" 
                data-bs-target="#{{ id_prefix }}-{{ tab.id }}-content" 
                type="button" 
                role="tab" 
                aria-controls="{{ id_prefix }}-{{ tab.id }}-content" 
                aria-selected="{{ 'true' if active_tab == tab.id else 'false' }}">
            {% if tab.icon %}<i class="fas fa-{{ tab.icon }} me-2"></i>{% endif %}{{ tab.label }}
        </button>
        {% endif %}
    </li>
    {% endfor %}
</ul>

{% if not base_url %}
<div class="tab-content">
    {{ caller() }}
</div>
{% endif %}
{% endmacro %}

{% macro tab_content(id, active=false, id_prefix="tab") %}
<div class="tab-pane fade {% if active %}show active{% endif %}" 
     id="{{ id_prefix }}-{{ id }}-content" 
     role="tabpanel" 
     aria-labelledby="{{ id_prefix }}-{{ id }}-tab">
    {{ caller() }}
</div>
{% endmacro %}

{% macro accordion(id, items, always_open=false) %}
<div class="accordion {% if ui_template == 'unified' %}accordion-dark{% endif %}" id="{{ id }}">
    {% for item in items %}
    <div class="accordion-item {% if ui_template == 'unified' %}bg-blue border-dark{% endif %}">
        <h2 class="accordion-header" id="heading-{{ id }}-{{ loop.index }}">
            <button class="accordion-button {% if loop.index != 1 %}collapsed{% endif %} {% if ui_template == 'unified' %}bg-dark-blue text-white{% endif %}" 
                    type="button" 
                    data-bs-toggle="collapse" 
                    data-bs-target="#collapse-{{ id }}-{{ loop.index }}" 
                    aria-expanded="{{ 'true' if loop.index == 1 else 'false' }}" 
                    aria-controls="collapse-{{ id }}-{{ loop.index }}">
                {% if item.icon %}<i class="fas fa-{{ item.icon }} me-2"></i>{% endif %}{{ item.title }}
            </button>
        </h2>
        <div id="collapse-{{ id }}-{{ loop.index }}" 
             class="accordion-collapse collapse {% if loop.index == 1 %}show{% endif %}" 
             aria-labelledby="heading-{{ id }}-{{ loop.index }}" 
             {% if not always_open %}data-bs-parent="#{{ id }}"{% endif %}>
            <div class="accordion-body {% if ui_template == 'unified' %}text-light{% endif %}">
                {{ item.content|safe }}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endmacro %}

{% macro progress_bar(value, max=100, size="", type="primary", striped=false, animated=false, label=true) %}
{% set progress_type = 'bg-' + (type if type != 'primary' or ui_template != 'unified' else 'teal') %}
{% set progress_class = size if size else '' %}
<div class="progress {% if progress_class %}{{ progress_class }}{% endif %} {% if ui_template == 'unified' %}bg-blue{% endif %}">
    <div class="progress-bar {{ progress_type }} {% if striped %}progress-bar-striped{% endif %} {% if animated %}progress-bar-animated{% endif %}" 
         role="progressbar" 
         style="width: {{ (value / max * 100)|round }}%;" 
         aria-valuenow="{{ value }}" 
         aria-valuemin="0" 
         aria-valuemax="{{ max }}">
        {% if label %}{{ (value / max * 100)|round }}%{% endif %}
    </div>
</div>
{% endmacro %}

{% macro toggle_switch(id, label="", checked=false, disabled=false, size="md", help_text="") %}
{% set switch_size = '' if size == 'md' else 'form-switch-' + size %}
<div class="form-check form-switch {{ switch_size }}">
    <input class="form-check-input" type="checkbox" role="switch" id="{{ id }}" {% if checked %}checked{% endif %} {% if disabled %}disabled{% endif %}>
    {% if label %}
    <label class="form-check-label {% if ui_template == 'unified' %}text-white{% endif %}" for="{{ id }}">
        {{ label }}
    </label>
    {% endif %}
    {% if help_text %}
    <div class="form-text {% if ui_template == 'unified' %}text-light-blue{% endif %}">{{ help_text }}</div>
    {% endif %}
</div>
{% endmacro %}