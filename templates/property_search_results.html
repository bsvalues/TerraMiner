{% extends "base.html" %}

{% block title %}Property Search Results{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-5xl mx-auto">
        <!-- Page Header -->
        <div class="flex flex-col md:flex-row justify-between items-start mb-6">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold mb-2">Property Search Results</h1>
                <p class="text-sm md:text-base text-gray-600 dark:text-gray-400">
                    Search query: <span class="font-semibold">{{ query }}</span>
                </p>
            </div>
            <div class="mt-4 md:mt-0">
                <a href="{{ url_for('property_record.property_search') }}" class="btn btn-outline btn-sm">
                    New Search
                </a>
            </div>
        </div>
        
        <!-- IAAO/USPAP Compliance Notice -->
        <div class="bg-blue-50 dark:bg-blue-900/30 border-l-4 border-blue-500 p-4 mb-6">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-blue-500" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div class="ml-3">
                    <p class="text-sm text-blue-800 dark:text-blue-200">
                        All property data complies with IAAO standards and USPAP. 
                        Data is sourced directly from {{ county|title }} County official assessment records.
                    </p>
                </div>
            </div>
        </div>
        
        {% if error %}
            <!-- Error Message -->
            <div class="card bg-base-100 shadow-xl mb-8">
                <div class="card-body">
                    <h2 class="card-title text-xl text-error">Search Error</h2>
                    
                    <div class="my-4">
                        <div class="bg-error/10 border-l-4 border-error p-4">
                            <div class="flex">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 text-error" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm text-error-content">
                                        {{ error }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <p class="mt-4">
                        Please try modifying your search query or try a different search method.
                    </p>
                    
                    <div class="mt-6">
                        <a href="{{ url_for('property_record.property_search') }}" class="btn btn-primary">
                            Return to Search
                        </a>
                    </div>
                </div>
            </div>
        {% elif results and results.count > 0 %}
            <!-- Results Summary -->
            <div class="flex justify-between items-center mb-4">
                <p class="text-sm text-gray-600 dark:text-gray-400">
                    Found <span class="font-semibold">{{ results.count }}</span> properties in {{ county|title }} County
                </p>
                <p class="text-sm text-gray-500 dark:text-gray-400">
                    Data source: {{ results.data_source }}
                </p>
            </div>
            
            <!-- Results Table -->
            <div class="overflow-x-auto mb-8">
                <table class="table table-zebra w-full">
                    <thead>
                        <tr>
                            <th>Parcel ID</th>
                            <th>Address</th>
                            <th>Owner</th>
                            <th class="text-right">Assessed Value</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for property in results.results %}
                            <tr>
                                <td class="font-mono text-sm">{{ property.parcel_id }}</td>
                                <td>{{ property.address }}</td>
                                <td>{{ property.owner_name }}</td>
                                <td class="text-right">${{ '{:,.0f}'.format(property.total_value) }}</td>
                                <td>
                                    <a href="{{ url_for('property_record.property_details', property_id=property.parcel_id, county=county) }}" 
                                       class="btn btn-primary btn-sm">
                                        View
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination (if needed) -->
            <!-- <div class="flex justify-center my-6">
                <div class="btn-group">
                    <button class="btn">«</button>
                    <button class="btn">Page 1</button>
                    <button class="btn">»</button>
                </div>
            </div> -->
        {% else %}
            <!-- No Results -->
            <div class="card bg-base-100 shadow-xl mb-8">
                <div class="card-body">
                    <h2 class="card-title text-xl">No Properties Found</h2>
                    
                    <p class="my-4">
                        No properties were found matching your search query in {{ county|title }} County.
                    </p>
                    
                    <div class="bg-warning/10 border-l-4 border-warning p-4 my-4">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-warning" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-warning-content">
                                    We only display authentic data from official county sources. If you believe this property should exist 
                                    in our records, please try a different search method or refine your query.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <h3 class="font-medium mt-6 mb-2">Search Tips:</h3>
                    <ul class="list-disc list-inside space-y-1 pl-2">
                        <li>Try searching by address without house number (e.g., "Main St")</li>
                        <li>Try searching by owner last name only</li>
                        <li>If you know the exact parcel ID, search using that</li>
                        <li>Check if you've selected the correct county</li>
                    </ul>
                    
                    <div class="mt-6">
                        <a href="{{ url_for('property_record.property_search') }}" class="btn btn-primary">
                            Return to Search
                        </a>
                    </div>
                </div>
            </div>
        {% endif %}
        
        <!-- Search Alternative Methods -->
        <div class="card bg-base-100 shadow-xl mb-8">
            <div class="card-body">
                <h2 class="card-title text-xl mb-4">Try Another Search Method</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <a href="{{ url_for('property_record.property_search') }}" class="card bg-base-200 shadow-sm hover:shadow-md transition-shadow">
                        <div class="card-body p-4">
                            <h3 class="font-medium">Search by Address</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">
                                Find properties using street address
                            </p>
                        </div>
                    </a>
                    
                    <a href="{{ url_for('property_record.property_search') }}" class="card bg-base-200 shadow-sm hover:shadow-md transition-shadow">
                        <div class="card-body p-4">
                            <h3 class="font-medium">Search by Owner</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">
                                Look up properties by owner name
                            </p>
                        </div>
                    </a>
                    
                    <a href="{{ url_for('property_record.property_search') }}" class="card bg-base-200 shadow-sm hover:shadow-md transition-shadow">
                        <div class="card-body p-4">
                            <h3 class="font-medium">Search by Parcel ID</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">
                                Direct lookup using parcel number
                            </p>
                        </div>
                    </a>
                </div>
            </div>
        </div>
        
        <!-- API Access Information -->
        <div class="text-sm text-gray-500 dark:text-gray-400 mb-8">
            <p>
                Developers: Access this data via our API at 
                <a href="{{ url_for('property_record.api_property_search', query=query, county=county) }}" class="link link-primary">
                    {{ url_for('property_record.api_property_search', query=query, county=county, _external=True) }}
                </a>
            </p>
        </div>
    </div>
</div>
{% endblock %}